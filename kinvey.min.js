!function(){"use strict";angular.module("kinvey",["ngResource","ngCookies","ngBase64"]).provider("$kinvey",["$base64",function(a){function b(a){return a&&a.document&&a.location&&a.alert&&a.setInterval}function c(a){return a&&a.$evalAsync&&a.$watch}function d(a,d){var e=d;if("string"==typeof a&&"$"===a.charAt(0)){var f=!1;angular.forEach(p,function(b){b==a&&(f=!0)}),f||(e=void 0)}else b(d)?e="$WINDOW":d&&document===d?e="$DOCUMENT":c(d)&&(e="$SCOPE");return e}function e(a,b){return"undefined"==typeof a?void 0:JSON.stringify(a,d,b?"  ":null)}var f,g=3,h="https://baas.kinvey.com/",i="appdata/",j="user/",k="group/",l="rpc/",m="custom/",n="blob/",o={user:{"X-Kinvey-API-Version":g,Authorization:""},basic:{"X-Kinvey-API-Version":g,Authorization:""}},p=["$gt","$gte","$in","$lt","$lte","$ne","$nin","$or","$and","$not","$nor","$exists","$type","$mod","$regex","$where","$geoWithin","$geoIntersects","$near","$nearSphere","$all","$elemMatch","$size","$","$elemMatch","$slice"];return{init:function(b){if(!b||!b.appKey||!b.appSecret)throw"$kinveyProvider.init requires an options object: {'appId':'YOUR APP ID','appSecret':'YOUR APP SECRET'}";f=b.appKey,o.user.Authorization=o.basic.Authorization="Basic "+a.encode(b.appKey+":"+b.appSecret),angular.toJson=e},$get:["$cookieStore","$resource","$http","$q",function(a,b,c,d){function e(){var a=d.defer();return c.get(h+i+f,{headers:o.basic}).then(function(b){a.resolve(b.data)},function(b){a.reject(b)}),a.promise}function g(a){return q(b(h+i+f+"/"+a+"/:_id",{_id:"@_id"},{create:{method:"POST",headers:o.user,params:{_id:""}},get:{method:"GET",headers:o.user},count:{method:"GET",headers:o.user,params:{_id:"_count"}},save:{method:"PUT",headers:o.user},"delete":{method:"DELETE",headers:o.user},query:{method:"GET",headers:o.user,isArray:!0,params:{_id:""}},group:{method:"POST",headers:o.user,isArray:!0,params:{_id:"_group"},transformRequest:function(a){return angular.toJson(a)}}}))}function p(a){return a.upload=x.upload,a.download=x.download,a}function q(a){angular.forEach(y,function(b){var c=a[b];a[b]=function(a,b,d,e){return a.query&&(a.query=JSON.stringify(a.query)),c(a,b,d,e)}});var b=a.group;return a.group=function(a){return a.reduce&&(a.reduce=a.reduce.toString(),a.reduce=a.reduce.replace(/\n/g,""),a.reduce=a.reduce.replace(/\s/g,"")),b(a)},a}function r(a,b){if(a===b)throw"aliases must not attempt to overwrite $kinvey."+b}function s(a,b){r(b,"handshake"),r(b,"User"),r(b,"Group"),r(b,"Object"),r(b,"alias"),A[b]=g(a)}function t(a,b){var e=d.defer();return c.post(h+l+f+"/"+m+a,b,{headers:o.user}).then(function(a){e.resolve(a.data)},function(a){e.reject(a)}),e.promise}var u=a.get(f+":authToken");u&&(o.user.Authorization=u);var v=q(b(h+j+f+"/:_id",{_id:"@_id"},{login:{method:"POST",params:{_id:"login"},transformResponse:function(b){return b=angular.fromJson(b),b.error||(o.user.Authorization="Kinvey "+b._kmd.authtoken,a.put(f+":authToken","Kinvey "+b._kmd.authtoken)),new v(b)},headers:o.user},current:{method:"GET",params:{_id:"_me"},headers:o.user},logout:{method:"POST",params:{_id:"_logout"},transformResponse:function(){o.user.Authorization=o.basic.Authorization,a.remove(f+":authToken")},headers:o.user},signup:{method:"POST",headers:o.basic,transformResponse:function(b){return b=angular.fromJson(b),b.error||(o.user.Authorization="Kinvey "+b._kmd.authtoken,a.put(f+":authToken","Kinvey "+b._kmd.authtoken)),new v(b)}},get:{method:"GET",headers:o.user},lookup:{method:"POST",headers:o.user,isArray:!0,params:{_id:"_lookup"}},save:{method:"PUT",headers:o.user},query:{method:"GET",headers:o.user,isArray:!0,params:{_id:""}},"delete":{method:"DELETE",params:{hard:!0},headers:o.user},suspend:{method:"DELETE",headers:o.user},verifyEmail:{method:"POST",headers:o.basic,url:h+l+f+"/:username:email/user-email-verification-initiate",params:{username:"@username",email:"@email"},transformRequest:function(){return""}},resetPassword:{method:"POST",headers:o.basic,url:h+l+f+"/:username:email/user-password-reset-initiate",params:{username:"@username",email:"@email"},transformRequest:function(){return""}},checkUsernameExists:{method:"POST",headers:o.basic,url:h+l+f+"/check-username-exists"}})),w=b(h+k+f+"/:_id",{_id:"@_id"},{get:{method:"GET",headers:o.user},save:{method:"PUT",headers:o.user},"delete":{method:"DELETE",headers:o.user}}),x={upload:function(a,b,e,g){var i=d.defer();return a._filename=g||a._filename,c({method:a._id?"PUT":"POST",url:h+n+f+(a._id?"/"+a._id:""),headers:angular.extend({"X-Kinvey-Content-Type":b},o.user),data:a}).then(function(a){var d=new z(a.data);c({method:"PUT",url:d._uploadURL,headers:angular.extend({"Content-Type":b,"Content-Length":e.length,Accept:void 0},d._requiredHeaders),data:e}).then(function(){i.resolve(d)},function(a){i.reject(a.data)})},function(a){i.reject(a.data)}),i.promise},download:function(a,b){var e=d.defer(),f={_id:a._id?a._id:a};b&&(f.ttl_in_seconds=b);var g=z.get(f);return g.$promise.then(function(){c.get(g._downloadURL,{}).then(function(a){e.resolve(a.data)},function(a){e.reject(a)})},function(a){e.reject(a)}),e.promise}},y=["query","delete"],z=p(q(b(h+n+f+"/:_id",{_id:"@_id"},{get:{method:"GET",headers:o.user},query:{method:"GET",headers:o.user,isArray:!0,params:{_id:""}},"delete":{method:"DELETE",headers:o.user}}))),A={handshake:e,User:v,Group:w,Object:g,File:z,alias:s,rpc:t};return A}]}}])}();